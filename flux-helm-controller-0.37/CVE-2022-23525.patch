From 687e3be70febf0f08fd1515baa4461f240c2966e Mon Sep 17 00:00:00 2001
From: Philippe Deslauriers <philde@chainguard.dev>
Date: Tue, 26 Dec 2023 01:06:29 +0000
Subject: [PATCH] Patch for CVE-2022-23525

Signed-off-by: Philippe Deslauriers <philde@chainguard.dev>
---
 controllers/helmrelease_controller.go | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/controllers/helmrelease_controller.go b/controllers/helmrelease_controller.go
index 8ec202a..5e0fad3 100644
--- a/controllers/helmrelease_controller.go
+++ b/controllers/helmrelease_controller.go
@@ -111,6 +111,7 @@ func (r *HelmReleaseReconciler) SetupWithManager(mgr ctrl.Manager, opts HelmRele
 	httpClient.Logger = nil
 	r.httpClient = httpClient
 
+	var recover = true
 	return ctrl.NewControllerManagedBy(mgr).
 		For(&v2.HelmRelease{}, builder.WithPredicates(
 			predicate.Or(predicate.GenerationChangedPredicate{}, predicates.ReconcileRequestedPredicate{}),
@@ -123,7 +124,7 @@ func (r *HelmReleaseReconciler) SetupWithManager(mgr ctrl.Manager, opts HelmRele
 		WithOptions(controller.Options{
 			MaxConcurrentReconciles: opts.MaxConcurrentReconciles,
 			RateLimiter:             opts.RateLimiter,
-			RecoverPanic:            true,
+			RecoverPanic:            &recover,
 		}).
 		Complete(r)
 }
-- 
2.25.1

