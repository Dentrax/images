package:
    name: mongosh
    version: 2.1.3
    epoch: 0
    description: The MongoDB Shell
    copyright:
        - license: Apache-2.0
environment:
    contents:
        packages:
            - ca-certificates-bundle
            - busybox
            - bash
            - nodejs-16
            - python3
            - build-base
            - curl
            - gnutar
            - krb5-dev
pipeline:
    - uses: git-checkout
      with:
        repository: https://github.com/mongodb-js/mongosh
        tag: v${{package.version}}
        expected-commit: 9ebc147d83037e9217dcd788f8092ae73010c9d6
    - runs: |
        export SEGMENT_API_KEY="dummy"
        export NODE_JS_VERSION=$(node --version)
        npm install -G lerna
        npm install -g typescript
        npm run bootstrap
        npm run compile-ts
        npm run compile-exec
        mkdir -p ${{targets.destdir}}/usr/bin/
        mv dist/mongosh ${{targets.destdir}}/usr/bin/
    - uses: strip
update:
    enabled: true
    github:
        identifier: mongodb-js/mongosh
        strip-prefix: v
