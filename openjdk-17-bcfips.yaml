package:
  name: openjdk-17-bcfips
  version: 17.0.9.9 # same version as our GA public one
  epoch: 1
  description: FIPS version of the OpenJDK package using BouncyCastle crypto APIs
  copyright:
    - license: GPL-2.0-only
    - license: MIT # BouncyCastle is licensed under the BouncyCastle License but their license state it is to be read as MIT: https://www.bouncycastle.org/license.html
  dependencies:
    runtime:
      - openjdk-17-jre-base~${{package.version}} # lock to the public GA version
      - openjdk-17-jre~${{package.version}} # lock to the public GA version
      - openjdk-17~${{package.version}} # lock to the public GA version
      - openjdk-17-default-jvm~${{package.version}} # lock to the public GA version
      - bouncycastle-fips
    provides:
      - jdk-fips=${{package.full-version}}

var-transforms:
  - from: ${{package.version}}
    match: ^(\d+).*
    replace: $1
    to: major-version

environment:
  contents:
    packages:
      - busybox
      - bash
      - openjdk-17~17.0.9.9 # lock to the public GA version
      - openjdk-17-default-jvm~17.0.9.9 # lock to the public GA version
      - bouncycastle-fips

pipeline:
  - name: Create the FIPS configuration
    runs: |
      DESTDIR="${{targets.destdir}}" ./create-config.sh

  - name: Test the overall setup
    runs: |
      DESTDIR="${{targets.destdir}}" VERSION="${{vars.major-version}}" ./test.sh

subpackages:
  - name: openjdk-17-jre-bcfips
    description: FIPS version of OpenJDK 17 Java Runtime Environment with BouncyCastle crypto APIs
    dependencies:
      runtime:
        - openjdk-17-jre-base~${{package.version}}
        - openjdk-17-jre~${{package.version}} # lock to the public GA version
        - bouncycastle-fips
      provides:
        - jre-fips=${{package.full-version}}
    pipeline:
      - runs: |
          DESTDIR="${{targets.subpkgdir}}" ./create-config.sh

update:
  enabled: false
